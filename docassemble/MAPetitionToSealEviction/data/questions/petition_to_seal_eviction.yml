---
include:
  - docassemble.AssemblyLine:assembly_line.yml
  - docassemble.MassAccess:massaccess.yml
  - docassemble.MATCTheme:matc_theme.yml
  - docassemble.ALToolbox:collapse_template.yml
  - support_efiling.yml
  - docassemble.MANoticeOfAppearanceForm:notice_of_appearance_form.yml
---
metadata:
  title: >-
    Petition to Seal Eviction
  short title: >-
    Petition to Seal Eviction
  description: |-
    This interview helps someone in Massachusetts file a Petition to Seal a prior eviction from public record.
  can_I_use_this_form: |
    If you are a tenant (defendant) who was evicted more than seven (7) years ago, you can use this interview to petition a court to seal the past eviction from public record.
  before_you_start: |
    This interview will help you file a Petition to Seal an Eviction.
    
    Before you get started, please gather:
    
    1. The name of the court your eviction action was heard in
    2. The docket number of your eviction action
    3. Any other documents relating to your eviction action
    3. The name and email of your attorney (if you have one)
    
    When you are finished, you will need to:
    
    E-file the petition with the applicable court
  maturity: production
  estimated_completion_minutes: 10
  estimated_completion_delta: 5
  LIST_topics: 
    - "CO-00-00-00-00"
    - "CO-07-00-00-00"
    - "HO-02-00-00-00"
  tags:
    - "CO-00-00-00-00"
    - "CO-07-00-00-00"
    - "HO-02-00-00-00"
  authors:
    - Taline
    - Rami
    - Quinten Steenhuis
  original_form: []
  original_form_published_on: 2025-02-06
  allowed_courts: 
    - "District Court"
    - "Boston Municipal Court"
    - "Housing Court"
    - "Superior Court"
  typical_role: "defendant"
  al_weaver_version: "1.11.0"
  generated_on: "2025-02-06"
  languages:
    - en
  jurisdiction: NAM-US-US+MA
  review_date: 2025-02-06
  form_titles:
    - Petition to seal eviction
  form_numbers: []
  update_notes: |
---
code: |
  # This controls the default country and list of states in address field questions
  AL_DEFAULT_COUNTRY = "US"
---
code: |
  # This controls the default state in address field questions
  AL_DEFAULT_STATE = "MA"
---
code: |
  github_repo_name =  'docassemble-MAPetitionToSealEviction'
---
code: |
  interview_short_title = "File a petition to seal an eviction"
---
code: |
  al_form_type = "existing_case" 
---
objects:
  - attorneys: ALPeopleList.using(complete_attribute=['bbo_number', 'address.address', 'phone_number'])
  - other_parties: ALPeopleList.using(there_are_any=True)
  - users: ALPeopleList.using(there_are_any=True)
  - users[i].tenancy_address: ALAddress
  - service_address: ALAddress
---
code: |
  if al_person_answering == "attorney":
    attorneys.there_are_any = True
---
code: |
  # Limit to 1 attorney
  if attorneys.number() >= 1:
    attorneys.there_is_another = False
---
# Placeholder section, we use al_nav_sections below for the actual navigation
sections:
  - intro: Introduction
---
code: |
  enable_al_nav_sections = True
---
reconsider: True
variable name: al_nav_sections
data:
  - section_intro: Introduction
  - section_court_info: Court information
  - section_efile_login: eFile login
    hidden: ${ (showifdef("user_wants_efile") == False) or showifdef("can_check_efile") == False }
  - section_can_i_seal: Can you seal your eviction record?
  - section_user_info: Your information
  - section_landlord_info: Landlord information
  - section_attorney_info: Attorney information
    hidden: ${ showifdef("al_person_answering") == "user" }
  - section_notice: Serving the other side
  - section_review: Review your form
  - section_signature: Signature
  - section_efile: eFile
    hidden: ${ showifdef("can_check_efile") == False or showifdef("petition_is_efileable") == False }
  - section_download: Download
---
#################### Interview order #####################
comment: |
  Controls order and branching logic for questions specific to this form
id: interview_order_petition_to_seal_eviction
code: |
  # Set the allowed courts for this interview
  allowed_courts = ['District Court', 'Boston Municipal Court', 'Housing Court', 'Superior Court']
  user_role = "defendant"
  user_ask_role = "defendant"
  
  nav.set_section("section_intro")
  al_intro_screen  
  petition_to_seal_eviction_intro
  al_person_answering
  if al_person_answering in ["attorney", "attorney_ghostwriting"]:
    attorney_message

  nav.set_section("section_court_info")
  trial_court.department
  trial_court.division

  nav.set_section("section_efile_login")
  if can_check_efile:
    tyler_login
    if case_search.found_case:
      previous_case_id = case_search.found_case.tracking_id
      if not petition_is_efileable:
        warn_sorry_not_efileable
      add_existing_users
    invalidate_address_information_once # Don't assume tenant is at the same address as in original case
  
  if not can_check_efile:
    nav.set_section("section_court_info")
  docket_number # If already looked up on Tyler, this just makes sure it is defined

  user_started_case
  if can_check_efile:
    lead_contact = users[0]

  nav.set_section("section_can_i_seal")
  case_outcome
  if not case_dismissed:
    judgment_outcome
    if judgment_outcome == "landlord":
      eviction_reason_nonpayment
      eviction_reason_fault
      eviction_reason_nofault
      eviction_reason_139
      if eviction_reason_fault:
        prior_eviction_action
        if prior_eviction_action:
          continue_inapplicable_new_eviction
        if appeal_period_expired_fault == False or (appeal_period_expired_fault is None and judgment_date > today().minus(years=7).minus(days=10)):
          continue_inapplicable_app_period
        fe_appl_period_exp
      elif eviction_reason_nonpayment:
        non_payment
        if non_payment:
          non_payment_cured
        if not non_payment:
          non_payment_hardship
          if non_payment_hardship:
            non_payment_action
            if non_payment_action:
              continue_inapplicable_new_nonpayment
            if not non_payment_action:
              if not nonpayment_appl_expired:
                continue_inapplicable_app_period
          if not non_payment_hardship:
            continue_inapplicable_no_hardship
      elif eviction_reason_139:
        prior_fault_action_139
        if prior_fault_action_139:
          continue_inapplicable_139_newfault
        prior_139_action
        if prior_139_action:
          continue_inapplicable_139_new139
        prior_139_offense
        if prior_139_offense:
          continue_inapplicable_139_newoffense
        if not ejp_appl_period_exp:
          continue_inapplicable_app_period        
      elif eviction_reason_nofault:
          if not nofault_judgment_period_exp:            
            continue_inapplicable_app_period
    else: # Judgment for tenant
      if case_outcome == "139_no_resolution":
        if not no_judgmt_appl_exp:
          continue_inapplicable_app_period
        
  if not showifdef("continue_inapplicable"): # User clicked past the exit screen
    user_probably_qualifies
  
  nav.set_section("section_user_info")
  users.gather()
  set_parts(subtitle=str(users))
  users[0].email
  users[0].address.has_no_address # Allow for homeless users
  set_progress(50)
  users[0].phone_number
  
  set_progress(75)
  nav.set_section("section_landlord_info")
  other_parties.gather()
  
  nav.set_section("section_attorney_info")
  if al_person_answering == "attorney":
    attorneys.gather()
    attorneys[0].bbo_number

  set_progress(90)
  nav.set_section("section_notice")
  if notice_required:
    notice_date
    notice_recipient
    notice_type

  # Trigger definitions for notice of appearance
  petitioners
  respondents

  interview_order_petition_to_seal_eviction = True
---
###################### Main order ######################
comment: |
  This block includes the logic for standalone interviews.
  Delete mandatory: True to include in another interview
mandatory: True
code: |
  tyler_payment_id
  al_intro_screen
  petition_to_seal_eviction_intro
  interview_order_petition_to_seal_eviction

  signature_date
  set_progress(99)
  
  nav.set_section("section_review")
  petition_to_seal_eviction_preview_question
  users[0].states_above_true

  nav.set_section("section_signature")
  basic_questions_signature_flow
  if can_check_efile:    
    nav.set_section("section_efile")
    interview_order_efiling

  # Store anonymous data for analytics / statistics
  store_variables_snapshot(
      persistent=True,
      data={
          "zip": showifdef("users[0].address.zip"),
          "tenancy_zip": showifdef("users[0].tenancy_address.zip"),
          "trial_court": showifdef("trial_court.name"),
          "trial_court_code": showifdef("trial_court.court_code"),
          "al_person_answering": showifdef("al_person_answering"),
          "user_wants_efile": showifdef("user_wants_efile"),
          "petition_is_efileable": showifdef("petition_is_efileable"),
          "efiled": showifdef("efile"),
          "case_type": showifdef("case_search.found_case.case_type_name"),
          "judgment_outcome": showifdef("judgment_outcome"),
          "case_outcome": showifdef("case_outcome"),
          "eviction_reason": showifdef("eviction_reason"),
          "reached_interview_end": True,
      },
  )

  set_progress(100)
  nav.set_section("section_download")
  petition_to_seal_eviction_download
  
---
id: Petition_to_Seal_Eviction
continue button field: petition_to_seal_eviction_intro
question: |
  Petition to seal an eviction
subquestion: |
  If you are a tenant whose landlord filed an eviction case against you, 
  you can use this interview to ask a judge or clerk to seal the court information. 
  
  Not all tenants qualify to seal their eviction record. This interview should not be used by commercial tenants seeking to seal an eviction.

  This interview will:

  * Help you understand if you can seal your eviction record using this interview.
  * Fill out a Petition to Seal Eviction Record Pursuant to G.L. c. 239, § 16 to file with the court.

  Before you get started, please gather:
    
  1. The docket number of the eviction case you want to seal<br>
  ([find your docket number](https://www.mass.gov/info-details/how-to-search-court-dockets?_gl=1*1t4lg0v*_ga*Mjc1NTYwNDQxLjE3NDE2MjkwMjA.*_)&nbsp;<sup>:up-right-from-square:&nbsp;(opens in new tab)</sup>)
  2. The name of the court that your eviction case was heard in
  3. Any other court documents from your eviction case
 
  Your court documents should have the information you need to fill out a petition. You can also find some of the information on [MassCourts.org](https://masscourts.org)&nbsp;<sup>:up-right-from-square:&nbsp;(opens in new tab)</sup>.

  <b>NOTE:</b> When you are finished, you will need to file this petition with the Court, either by eFile using a valid email address or in person with the Clerk's office.

  Most people take about 10 minutes to complete this interview.
---
id: User Type
question: |
  Are you the tenant or the attorney for the tenant?
fields:
  - "I am the:": al_person_answering
    datatype: radio
    choices:
      - Tenant asking to seal my eviction case: user
      - Attorney for the tenant: attorney
      - Attorney assisting in preparation of this pleading in accordance with Trial Court Rule XVI: attorney_ghostwriting 
  - Is this your **first** appearance on behalf of this tenant?: attorney_first_appearance
    datatype: yesnoradio
    show if:
      variable: al_person_answering
      is: "attorney"
  - note: |
      Because this is your first appearance in the case, a notice of appearance will be generated through this interview. It will be filed along with your petition.
    show if: attorney_first_appearance
---
id: Attorney Message
continue button field: attorney_message
decoration: circle-info
question: |
  Your client will need to sign this form
subquestion: |
  The petition you are about to make must be signed by your client under the penalties of perjury.

  Make sure the tenant is here with you to sign this form.
continue button label: I understand
# TODO: set up remote signing functionality
---
id: Eviction Reason
question: |
  Why did your landlord ask the court to evict you?
subquestion: |
  To answer this question, look at the paperwork that you got from your landlord.

  ${ collapse_template(eviction_reason_template) }

  % if can_check_efile and case_search.found_case and predicted_eviction_reason and trial_court.department == "Housing Court":
  <div class="border rounded p-3 alert-info text-dark" style="position: relative; overflow: visible; word-wrap: break-word;">
    <p><i class="fa-solid fa-circle-info"></i>
    We used the information we found in your court records to automatically
    choose an answer for this question.
    </p>
    <p>
    If the checked answer is not right, you can un-check our answer
    and check the right answer. You might need to explain to the clerk or the judge
    that there is a mistake in your court file at the hearing.  
    </p>
  </div>
  % endif
fields:
  - The landlord told the court in the summons and complaint that: eviction_reason
    label above field: True
    datatype: radio
    choices:
      - "Non-payment of rent: I owed money for rent": eviction_reason_nonpayment
      - "Fault: I broke the lease other than owing rent. For example: a noise complaint or damage to the apartment, or repeatedly paying the rent late.": eviction_reason_fault
      - "No fault: They did not want to rent to me any longer, but not because of something I did": eviction_reason_nofault
      - "139 § 19: I broke the law and they filed an emergency eviction under G.L. c. 139, § 19. For example, they claimed I had drugs, had an illegal weapon, acted violently, or violated another criminal law.": eviction_reason_139
    default: ${ showifdef("predicted_eviction_reason") if trial_court.department == "Housing Court" else '' }
validation code: |
  # TODO: we can remove this validation code if we update template to new format
  eviction_reason_nonpayment = eviction_reason_fault = eviction_reason_nofault = eviction_reason_139 = False

  if eviction_reason == "eviction_reason_nonpayment":
    eviction_reason_nonpayment = True
  elif eviction_reason == "eviction_reason_fault":
    eviction_reason_fault = True
  elif eviction_reason == "eviction_reason_nofault":
    eviction_reason_nofault = True
  elif eviction_reason == "eviction_reason_139":
    eviction_reason_139 = True
---
template: eviction_reason_template
subject: |
  How do I know what eviction reason to write?
content: |
  Look at the paperwork that you got from your landlord and from the court. Look for the key words:

  * "Nonpayment of rent"
  * "Cause" or "Breach of lease"
  * "No cause", "No fault" or "without the fault of the tenant"
  * "139 § 19" or "nuisance"

  Even if you were evicted for a "fault" reason, your landlord may have also listed a "nonpayment" reason.
  Make sure to check the box for "fault" if the landlord said in the court paperwork that you broke another part of the lease.
---
id: Off Ramp
decoration: hand
question: |
  You may not be able to seal your eviction record
subquestion: |
  Based on your answers, you may not be eligible to complete the petition form using this guided interview.

  You can find more information about petition eligibility and other ways to file the petition [here](https://www.mass.gov/).

  Please contact your Clerk's Office if you have additional questions.

sets: continue_inapplicable
buttons:
  - Restart: restart
  - Exit: exit
---
id: Off Ramp Appeal Period
decoration: hand
question: |
  You may not be able to seal your eviction record
subquestion: |
 Based on the judgment date you provided, your appeal period has not yet expired.

 **Your appeal period must have expired before you may seal your eviction record.**

  You can find more information about petition eligibility and other ways to file the petition [here](https://www.mass.gov/).

  Please contact your Clerk's Office if you have additional questions.

sets: continue_inapplicable_app_period
buttons:
  - Restart: restart
  - Exit: exit
---
id: Off Ramp New Eviction
decoration: hand
question: |
  You may not be able to seal your eviction record
subquestion: |
 Based on your answers, you may not be eligible to complete the petition form using this guided interview.

 **If a new eviction case has been filed against you at any time in the past 7 years, you may not qualify to have your eviction record sealed.**

  You can find more information about petition eligibility and other ways to file the petition [here](https://www.mass.gov/).

  Please contact your Clerk's Office if you have additional questions.

sets: continue_inapplicable_new_eviction
buttons:
  - Restart: restart
  - Exit: exit
---
id: Off Ramp New Nonpayment Action
decoration: hand
question: |
  You may not be able to seal your eviction record
subquestion: |
 Based on your answers, you may not be eligible to complete the petition form using this guided interview.

 **If any other evictions have been brought against you in Massachusetts for not paying your rent in the last 4 years, you may not qualify to have your eviction record sealed.**

  You can find more information about petition eligibility and other ways to file the petition [here](https://www.mass.gov/).

  Please contact your Clerk's Office if you have additional questions.

sets: continue_inapplicable_new_nonpayment
buttons:
  - Restart: restart
  - Exit: exit
---
id: Off Ramp No Hardship
decoration: hand
question: |
  You may not be able to seal your eviction record
subquestion: |
 Based on your answers, you may not be eligible to complete the petition form using this guided interview.

 **If you failed to pay your rent for any reason other than economic hardship, you may not qualify to have your eviction record sealed.**

  You can find more information about petition eligibility and other ways to file the petition [here](https://www.mass.gov/).

  Please contact your Clerk's Office if you have additional questions.

sets: continue_inapplicable_no_hardship
buttons:
  - Restart: restart
  - Exit: exit
---
id: Off Ramp 139 New Fault Action
decoration: hand
question: |
  You may not be able to seal your eviction record
subquestion: |
 Based on your answers, you may not be eligible to complete the petition form using this guided interview.

 **If your eviction was a civil action under G.L. c. 139, §19, you may not qualify to have your eviction record sealed if you have had another fault eviction in the past 7 years.**

  You can find more information about petition eligibility and other ways to file the petition [here](https://www.mass.gov/).

  Please contact your Clerk's Office if you have additional questions.

sets: continue_inapplicable_139_newfault
buttons:
  - Restart: restart
  - Exit: exit
---
id: Off Ramp 139 New 139 Action
decoration: hand
question: |
  You may not be able to seal your eviction record
subquestion: |
 Based on your answers, you may not be eligible to complete the petition form using this guided interview.

 **If your eviction was a civil action under G.L. c. 139, §19, you may not qualify to have your eviction record sealed if you have had another eviction under G.L. c. 139, §19 in the past 7 years.**

  You can find more information about petition eligibility and other ways to file the petition [here](https://www.mass.gov/).

  Please contact your Clerk's Office if you have additional questions.

sets: continue_inapplicable_139_new139
buttons:
  - Restart: restart
  - Exit: exit
---
id: Off Ramp 139 New 139 Offense
decoration: hand
question: |
  You may not be able to seal your eviction record
subquestion: |
 Based on your answers, you may not be eligible to complete the petition form using this guided interview.

 **If your eviction was a civil action under G.L. c. 139, §19, you may not qualify to have your eviction record sealed if you have had a conviction for any of the crimes listed in G.L. c. 139, § 19 in the past 7 years.**

  You can find more information about petition eligibility and other ways to file the petition [here](https://www.mass.gov/).

  Please contact your Clerk's Office if you have additional questions.

sets: continue_inapplicable_139_newoffense
buttons:
  - Restart: restart
  - Exit: exit
---
id: may qualify
decoration: circle-check
question: |
  You may qualify to seal your eviction record
subquestion: |
  Based on the answers that you gave, you may qualify to seal your eviction record under Massachusetts law.

  Only the court can make the final decision.

  The next questions will complete the petition for you to file with the court.
continue button field: user_probably_qualifies
---
id: satisfaction of judgment
question: |
  Satisfaction of judgment
subquestion: |
  Even if you paid all of the rent due, you cannot seal the eviction until the payment was officially recorded by the court. 
  This is called "satisfaction of judgment."

  Did any of the following happen?
fields:
  - no label: non_payment_cured 
    input type: radio
    choices: 
      - My landlord filed a notice of satisfaction of judgment with the court: landlord_filed_satisfaction
      - A judge deemed all amounts due in rent were paid: judge_deemed_satisfied
      - My payment has not been deemed satisfied by the court: False
  - note: |
      :triangle-exclamation:

      If you have paid all the money you owed you can ask your landlord to file a Notice of Satisfaction of Judgment with the court. 

      If you cannot reach your landlord or they do not file the Notice of Satisfaction, you will need to file a 
      Petition for Judgment or Agreement to be Deemed Satisfied.
      
      Once the Notice of Satisfaction of Judgment has been filed, or Petition for Judgment or Agreement to be Deemed
      Satisfied has been allowed by the court, come back and complete the interview and Petition to Seal your Eviction Record.
    show if:
      variable: non_payment_cured
      is: False
---
id: Non Payment Not Paid
question: |
  Have you paid all of the money you owed your landlord?
fields:
  - I paid all of the money owed: non_payment
    datatype: yesnoradio
  - I could not pay all of the money owed because I had an economic hardship: non_payment_hardship
    datatype: yesnoradio
    show if: 
      variable: non_payment
      is: False
---
id: Non Payment Action
question: |
  Other evictions for nonpayment of rent
subquestion: |
  In the last 4 years, since **${ today().minus(years=4) }**, has any other eviction or lessor action been brought against you in Massachusetts for not paying your rent?
fields:
  - A landlord has started a new case against me for nonpayment of rent **or** a lessor action has been filed against me since ${ today().minus(years=4) }: non_payment_action
    datatype: yesnoradio
---
id: Fault Eviction
question: |
  Do you have any other recent eviction cases?
subquestion: |
  Has someone filed a new eviction case or lessor action against you at any time in the **last 7 years?**
fields:
  - Another eviction case or lessor action has been filed against me since ${ today().minus(years=7) }: prior_eviction_action
    datatype: yesnoradio
---
id: Fault Action Section 139
question: |
  Evictions for a fault reason
subquestion: |
  In the last 7 years (since ${ today().minus(years=7) }), has a landlord asked a judge to evict you 
  for one of these reasons?
fields:
  - "Any fault reason: I broke the lease for a reason other than nonpayment of rent.": prior_fault_action_139
    datatype: yesnoradio
  - "139, §19: I broke the law and the landlord filed an emergency eviction": prior_139_action
    datatype: yesnoradio
---
id: Prior Criminal Offenses
question: |
  Criminal offenses listed under G.L. c. 139, § 19
subquestion: |
  Since **${ today().minus(years=7) }**, have you been convicted of a crime listed in G.L. c. 139, § 19?

  These crimes include:

  * Drug offenses
  * Illegal weapons
  * Prostitution
  * Illegal gambling
  * Illegal keeping or sale of alcohol, or habitually serving alcohol to somoene who is intoxicated or who you had reason to know would operate a vehicle under the influence
  * Violence or threats against an employee in a public or subsidized housing unit

fields:
  - Have you been convicted of one of the above crimes in the last 7 years?: prior_139_offense
    datatype: yesnoradio
---
id: Notice
question: |
  Serving the other side
subquestion: |
  You need to give a copy of the petition to your former landlord, or their attorney if
  they have one.

  Before you can file, you need to tell the court how you will serve the other side.

  I intend to serve notice on ${ other_parties } by:
fields:
  - "Giving a copy of the petition to:": notice_recipient
    datatype: radio
    choices:
      - ${ other_parties }: plaintiff
      - The attorney for ${ other_parties }: plaintiff lawyer
  - "I intend to send notice by:": notice_type
    datatype: radio
    choices:
      - Email: email
      - Mail: mail
      - In person: in person
  - Email address: service_email_address
    datatype: email
    show if: 
      variable: notice_type
      is: email
  - code: |
      service_address.address_fields(show_if={"variable": "notice_type", "is": "mail"} )
  - "Service date": notice_date
    datatype: date
    default: ${ today().format("yyyy-MM-dd") }
---
id: Petitioner Signature
question: |
  Your signature
subquestion: |
  Sign your name below
fields:
  - users[0].signature: signature
---
sets:
  - attorneys[0].name.first
id: Attorney Information
question: |
  Attorney information
fields:
  - code: |
      attorneys[0].name_fields()
  - Email: attorneys[0].email
    required: False
  - Phone number: attorneys[0].phone_number
    required: False
  - BBO Number: attorneys[0].bbo_number
    required: False
  - code: |
      attorneys[0].address_fields()
---
id: appeal period expired for a nonpayment of rent case
question: |
  Has it been at least 4 years since the appeal period expired?
subquestion: |
  If you are not sure, we can help you calculate it from the date your case
  reached an agreement or the date the judge made a decision.
fields:
  - "Has it been at least 4 years since the appeal period expired?": appeal_period_expired_nonpayment
    datatype: yesnomaybe
---
id: appeal period expired for fault case
question: |
  Has it been at least 7 years since the appeal period expired?
subquestion: |
  If you are not sure, we can help you calculate it from the date your case
  reached an agreement or the date the judge made a decision.
fields:
  - "Has it been at least 7 years since the appeal period expired?": appeal_period_expired_fault
    datatype: yesnomaybe
---
id: appeal period expired for 139 19 case
question: |
  Has it been at least 7 years since the appeal period expired?
subquestion: |
  If you are not sure, we can help you calculate it from the date your case
  reached an agreement or the date the judge made a decision.
fields:
  - "Has it been at least 7 years since the appeal period expired?": appeal_period_expired_139
    datatype: yesnomaybe
---
id: 139 appeal period expired judgment for tenant or no fault eviction
question: |
  Has the appeal period expired for your case?
subquestion: |
  Your appeal period is usually **10 days** from the date of the decision or agreement.

  If you are not sure, we can help you calculate it from the date your case
  reached an agreement or the date the judge made a decision.
fields:
  - "Has the appeal period expired?": appeal_period_expired_dismissal_or_nofault
    datatype: yesnomaybe
---
id: Date of Judgment
question: |
  When was the court decision final?
subquestion: |
  The date that the court decision was final is called the **judgment date**.
fields:
  - "Judgment entered on:": judgment_date
    datatype: ThreePartsDate
---
sets:
  - users[0].tenancy_address.address
  - users[0].tenancy_address.city
id: tenancy_address
question: |
  What is the address of the property for the eviction you want to seal?
subquestion: |
  Enter the address of the property you were renting when the landlord filed the eviction.
fields:
  - code: |
      users[0].tenancy_address.address_fields(default_state='MA')
---
only sets:
  - case_outcome
  - judgment_outcome
id: Eviction Action Dismissed
question: |
  How did your eviction case end?
subquestion: |
  ${ collapse_template(case_outcome_template) }
fields:
  - My eviction case was: case_outcome
    datatype: radio
    choices:
      - "**Dismissed** by the court or in a written agreement": dismissed
      - "Ended with a court ruling **in my favor**": decided_for_me # settled
      - Ended with a court ruling **against me**: decided_against_me # decided
      - This was a 139 § 19 case and judgment did not enter for either party: 139_no_resolution
validation code: |
  if case_outcome == "139_no_resolution":
    judgment_outcome = "nobody"
    eviction_reason_139 = True
  elif case_outcome == "decided_for_me":
    judgment_outcome = "tenant"
  elif case_outcome == "decided_against_me":
    judgment_outcome = "landlord"
  elif case_outcome == "unknown":
    judgment_outcome = "unknown"
  else:
    judgment_outcome = None
---
template: case_outcome_template
subject: |
  How do I know how the case ended?
content: |
  Look at the final decision from the court or the final document you signed to see how your case ended.

  If you signed an agreement, it might have been an agreement to dismiss the case,
  or an agreement that said one party had a judgment against them.

  Look for key words in the agreement or decision title.

  A **stipulation of dismissal** is a written agreement by the parties asking the court to dismiss the case. 
  The parties may include some other terms in the agreement, but the main purpose of the agreement is to request the 
  case be dismissed. If your agreement was a stipulation of dismissal, then check the box that says, 
  "The eviction case was dismissed by the court or in a written agreement."

  An **agreement for judgment** is a written agreement by the parties asking the court to enter judgment in favor
  of either the landlord or the tenant. The agreement for judgment may include other terms but the main purpose
  is to request that the court enter a judgment.
  
  * If your agreement was an agreement for judgment in your favor,
  then check the box that says, "The eviction case ended with a court ruling in my favor."
  * If the agreement for judgment was in favor of your landlord, then check the box that says, 
  "The eviction case ended with the court ruling against me."

  A **default judgment** enters when the tenant fails to appear in court and the landlord appears. 
  If a default judgment was entered against you, check the box that says, 
  "The eviction case ended with the court ruling against me"
  
  A **dismissal judgment** enters when the landlord fails to appear in court and the tenant appears. 
  If a dismissal judgment was entered against your landlord, check the box that says, 
  "The eviction case was dismissed by the court or in a written agreement."
  
  You may also find the information on [MassCourts.org](https://masscourts.org)&nbsp;<sup>:up-right-from-square: (opens in new tab)</sup>.
---
code: |
  case_dismissed = case_outcome == "dismissed"
---
id: preview petition_to_seal_eviction
question: |
  Preview your form before you sign it
subquestion: |
  Here is a preview of the form you will sign on the next page.   
  
  ${ al_court_bundle.as_pdf(key='preview') }

  Click the image to open it in a new tab. Click the **Edit answers** button
  to edit your answers.

  ${ action_button_html(url_action('review_petition_to_seal_eviction'), label='Edit answers', color='info') }
  
  Remember to come back to this window to continue and sign your form.
continue button field: petition_to_seal_eviction_preview_question    
---
code: |
  if al_person_answering == "attorney":
    signature_fields = ['attorneys[0].signature', 'users[0].signature']
  else:
    signature_fields = ['users[0].signature']
---
code: |
  addresses_to_search = [users[0].tenancy_address]
---
id: choose a court (no courts matching provided address were found)
question: |
  What court was your case decided in?
subquestion: |
  Look at your court paperwork. Match the name listed there.
fields:
  - no label: trial_court
    datatype: object
    object labeler: court_short_label
    choices: all_courts.filter_courts(allowed_courts)
---
if: |
  len(all_matches) and all_courts.filter_courts(allowed_courts) 
id: choose a court (courts matching provided address were found)
question: |
  What court was your case decided in?
subquestion: |
  Look at your court paperwork. Match the name listed there.

  The first choices below are courts that match the address you said you lived in
  at the time of your eviction case. If you do not see your court, 
  select "A court not listed here" and select the court name below.
fields:
  - no label: trial_court
    datatype: object_radio
    choices: all_matches
    none of the above: |
      A court not listed here
    # disable others: True
    object labeler: court_short_description
    show if: 
      code: |
        len(all_matches)      
  - no label: trial_court
    datatype: object
    object labeler: court_short_label
    choices: all_courts.filter_courts(allowed_courts)
    show if:
      variable: trial_court
      is: null
---
# code: |
#   # Because we disabled name lookup
#   # Start with docket number lookup, since it is now mandatory
#   # This block is highest priority  
#   if all_courts.courts_from_docket_number(docket_number):
#     trial_court = all_courts.courts_from_docket_number(docket_number)[0]
#     # let the user know that we found a court
#     confirm_trial_court
# ---
# only sets:
#   - confirm_trial_court
# continue button field: confirm_trial_court
# id: confirm_trial_court
# question: |
#   We found a court that matches your docket number
# subquestion: |
#   The court that matches your docket number is ${ trial_court }.

#   If this is not the right court, click the **Undo** button and try
#   a different docket number.
---
id: name of landlord
question: |
  What was the name of your landlord?
subquestion: |
  If more than one name is listed as the landlord on the eviction paperwork, you can give those names on the next page.
fields:
  - Landlord's full name: other_parties[i].name.first
    under text: |
      Match the exact name listed on your court paperwork.
  - note: |
      ${ collapse_template(landlord_name_template) }
---
template: landlord_name_template
subject: |
  Where do I find my landlord's name on my court paperwork?
content: | 
  Your landlord would be listed as the Plaintiff on your court paperwork.
---
id: any other opposing parties
question: |
  Was there any **other** landlord listed on your eviction paperwork?
subquestion: |
  You have already told us about ${ other_parties.complete_elements() }
fields:
  - no label: other_parties.there_is_another
    datatype: yesnoradio
---
id: any other users
question: |
  Was another tenant listed on the eviction paperwork?
subquestion: |
  So far you have told us about ${comma_and_list(users.complete_elements())}.
fields:
  - no label: users.there_is_another
    datatype: yesnoradio
---
sets:
  - users[0].address.has_no_address
id: user i's address
question: |
  % if al_person_answering == "user":
  What is your address now?
  % else:
  What is ${ users[0] }'s address now?
  % endif
fields:
  - I have no address: users[0].address.has_no_address
    datatype: yesno
    disable others: True
  - code: |
      users[0].address_fields(default_state='MA')
---
sets:
  - users[i].name.first
  - users[i].name.last
  - users[i].name.middle
  - users[i].name.suffix    
id: other users names
question: |
  % if i == 0 and al_person_answering == "user":
  What is your name?
  % else:
  % if al_form_type in ['starts_case','existing_case','appeal']:
  Who is the ${ ordinal(i) } tenant on your side of the case?
  % else:
  What is the name of the ${ ordinal_number(i) } tenant who is adding their name to
  this form with you?
  % endif
  % endif
fields:
  - code: |
      users[i].name_fields()
---
id: your contact information
question: |
  What is your contact information?
subquestion: |
  If you do not have a phone number or email address,
  write the phone number or email of someone who can reach you.
fields:  
  - Mobile number: users[0].mobile_number
    required: False
  - Other phone number: users[0].phone_number
    required: False
  - Email address: users[0].email    
    datatype: email
    required: False
---
id: affirmation and oath of no perjury
question: |
  Signing under oath (tenant)
subquestion: |
  Your petition must be signed under oath.
  That means everything you say must be true as far as you know.
  You may be punished by a judge if you intentionally
  say something that is not true.
fields:
  - no label: users[i].states_above_true
    datatype: checkboxes
    minlength: 1
    choices:
      - I affirm that the answers I have given are true, under the penalties of perjury: states_true
    validation messages:
      minlength: |
        You cannot keep going unless you did your best to tell the truth.
---
id: docket number
question: |
  What is the docket number for your eviction case?
subquestion: |
  ${ collapse_template(find_my_docket_number_template) }
fields:
  - Docket number: docket_number
    under text: |
      Example: **30H84SP009123**. (This is not a real docket number. Use the number on your paperwork.)
  - note: |
      This might not be a valid docket number. Check the number on your paperwork,
      and make sure you do not include any spaces or dashes. Letters in a docket
      number are usually uppercase.
    js show if: | # Use javascript to validate the docket number
      val("docket_number") != "" &&  
            !/^\d{2,4}(?:[A-Z]\d{2}|\d{2})[A-Z]{2}\d+$/.test(
              val("docket_number")
            );
---
template: find_my_docket_number_template
subject: |
  How do I find my docket number?
content: |
  If you do not know your docket number, search by name on [MassCourts.org](https://masscourts.org):up-right-from-square: (opens in new tab).
  You may also see the docket number written on paperwork that you got from the court or from your landlord.

  A docket number almost always:

  * Starts with a 2 or 4 digit year
  * Is followed by a code for the court, like H84 for the Eastern Housing Court or 52 for Cambridge District Court
  * Is followed by a code for the case type, like SP, SU, or CV
  * Ends in a number that is unique to your case, usually with leading zeros to make it 6 digits

  Example: **30H84SP009123**. (This is not a real docket number. Use the number on your paperwork.)

  If you think you know the docket number but you cannot find your case, try making sure that the number follows the
  rules above. For example, remove any punctuation.
---
######### logic ###############
---
code: |
  nonpayment_appl_expired = (
    eviction_reason_nonpayment
    and judgment_outcome == "landlord"
    and not non_payment_action
    and not (
        appeal_period_expired_nonpayment == False
        or (
            appeal_period_expired_nonpayment is None
            and judgment_date > today().minus(years=4).minus(days=10)
        )
    )
  )
---
code: |
  nofault_judgment_period_exp = eviction_reason_nofault and not (
    appeal_period_expired_dismissal_or_nofault == False
    or (
        appeal_period_expired_dismissal_or_nofault is None
        and judgment_date > today().minus(days=10)
    )
  )
---
code: |
  no_judgmt_appl_exp = (
    case_outcome == "139_no_resolution"
    and not (
      appeal_period_expired_dismissal_or_nofault == False
      or (
        appeal_period_expired_dismissal_or_nofault is None
        and judgment_date > today().minus(days=10)
      )
    )
  )
---
code: |
  ejp_appl_period_exp = (
    eviction_reason_139
    and judgment_outcome == "landlord"
    and not prior_139_action
    and not prior_139_offense
    and not (
        appeal_period_expired_139 == False
        or (
            appeal_period_expired_139 is None
            and judgment_date > today().minus(years=7).minus(days=10)
        )
    )
  )
---
code: |
  fe_appl_period_exp = (
    eviction_reason_fault
    and judgment_outcome == "landlord"
    and not prior_eviction_action
    and not (
        appeal_period_expired_fault == False
        or (
            appeal_period_expired_fault is None
            and judgment_date.plus(years=7).plus(days=10) < today()
        )
    )
  )
---
code: |
  notice_required = not (
    case_dismissed or
    judgment_outcome == "tenant"
  )
---
id: petition to seal eviction review screen
event: review_petition_to_seal_eviction
question: |
  Review your answers
subquestion: |
  You can update some of your answers on this screen. If you don't see the answer you want to update, you can start over.
review:
  - Edit: attorneys.revisit
    button: |
      **Attorneys**

      % for item in attorneys:
        * ${ item }
      % endfor
  - Edit: users.revisit
    button: |
      **Users**

      % for item in users:
        * ${ item }
      % endfor
  - Edit: other_parties.revisit
    button: |
      **Other parties**
      % for item in other_parties:
        * ${ item }
      % endfor
  - Edit: trial_court
    button: |
      **Court**
  
      % if defined("trial_court.division"):
      * division: ${ trial_court.division }
      % endif
      % if defined("trial_court.department"):
      * department: ${ trial_court.department }
      % endif
---
continue button field: attorneys.revisit
question: |
  Edit attorneys
subquestion: |
  ${ attorneys.table }

  ${ attorneys.add_action() }
---
table: attorneys.table
rows: attorneys
columns:
  - Email: |
      row_item.email if defined("row_item.email") else ""
  - Signature: |
      row_item.signature if defined("row_item.signature") else ""
  - Name: |
      row_item.name.full() if defined("row_item.name.first") else ""
edit:
  - email
  - signature
  - name.first
confirm: True

---
continue button field: users.revisit
question: |
  Edit users
subquestion: |
  ${ users.table }

  ${ users.add_action() }
---
table: users.table
rows: users
columns:
  - Email: |
      row_item.email if defined("row_item.email") else ""
  - Signature: |
      row_item.signature if defined("row_item.signature") else ""
  - Name: |
      row_item.name.full() if defined("row_item.name.first") else ""
  - Address: |
      row_item.address.block() if defined("row_item.address.address") else ""
  - Phone number: |
      row_item.phone_number if defined("row_item.phone_number") else ""
edit:
  - email
  - signature
  - name.first
  - address.address
  - phone_number
confirm: True

---
continue button field: other_parties.revisit
question: |
  Edit other_parties
subquestion: |
  ${ other_parties.table }

  ${ other_parties.add_action() }
---
table: other_parties.table
rows: other_parties
columns:
  - Name: |
      row_item.name.full() if defined("row_item.name.first") else ""
edit:
  - name.first
confirm: True

---
id: download petition_to_seal_eviction
event: petition_to_seal_eviction_download
question: |
  Your petition information has been filled out
subquestion: |
  % if can_check_efile and petition_is_efileable and showifdef('efile'):
  Thank you ${users}. Your form has been delivered. You can download a copy
  of your form below. You will get updates about your case by email.
  % else:
  Thank you ${users}. Your form is ready to download and deliver to the court.

  Make sure you are able to print or e-file the form once you have reviewed.

  If you are not ready to file, make an account to save your completed form.
  
  View and download your form below. Click the **Edit answers** button to fix any mistakes.

  % if defined("continue_inapplicable"):
  <div class="alert alert-warning" role="alert">
    <strong>Important:</strong> Your answers do not appear to meet the legal requirements to seal your eviction record. The court may reject your petition.
    We recommend that you talk to an attorney before continuing to file your document.
  </div>

  % endif

  ${ action_button_html(url_action('review_petition_to_seal_eviction'), label='Edit answers', color='info') }


  <!-- E-file button -->
  % if can_check_efile and petition_is_efileable and not (defined('efile') and efile):
  <h2 class="h4">E-file your form</h2>
  
  Click the **E-file** button below to e-file your form.
  
  ${ action_button_html(url_ask([{'recompute': ['efile']}]), label='E-file', id_tag='efile-button', icon='file-export', size='md')}

  % endif

  % endif # can_check_efile and petition_is_efileable and showifdef('efile')
  
  <h2 class="h4">Download for your records</h2>
  ${ al_user_bundle.download_list_html() }
  
  ${ al_user_bundle.send_button_html(show_editable_checkbox=True) }

  ${ action_button_html(url_of("new_session"), label="Start a new petition", icon="square-plus", size="md", color="secondary") }

progress: 100
prevent going back: True
---
auto terms:
  lessor action: |
    Any civil action brought against the owner, manager or lessor of residential premises by the tenant or occupant of such premises relating to or arising out of such property, rental, tenancy or occupancy for breach of warranty, breach of any material provision of the rental agreement or violation of any other law.
  service date: |
    The date you will give a copy of the petition to the other side. This is called "service of process."
---
# ALDocument objects specify the metadata for each template
objects:
  - petition_to_seal_eviction_Post_interview_instructions: ALDocument.using(title="Instructions", filename="petition_to_seal_eviction_next_steps.docx", enabled=True, has_addendum=False)
  - petition_to_seal_eviction_attachment: ALDocument.using(title="Petition to Seal Eviction", filename="petition_to_seal_eviction", enabled=True, has_addendum=False, )
---
# Bundles group the ALDocuments into separate downloads, such as for court and for the user
objects:
  - al_user_bundle: ALDocumentBundle.using(elements=[
              petition_to_seal_eviction_Post_interview_instructions,
              petition_to_seal_eviction_attachment,
              notice_of_appearance_form_attachment,
            ],
            filename="petition_to_seal_eviction",
            title="All forms to download for your records", 
            enabled=True
          )
  - al_court_bundle: ALDocumentBundle.using(elements=[
            petition_to_seal_eviction_attachment,
            notice_of_appearance_form_attachment,
          ],
          filename="petition_to_seal_eviction",
          title="All forms to deliver to court",
          enabled=True
          )
---
code: |
  notice_of_appearance_form_attachment.enabled = al_person_answering == "attorney" and attorney_first_appearance  
---
# Each attachment defines a key in an ALDocument. We use `i` as the placeholder here so the same template is 
# used for "preview" and "final" keys, and logic in the template checks the value of 
# `i` to show or hide the user's signature
attachment:
  name: Post-interview-Instructions
  filename: petition_to_seal_eviction_next_steps
  docx template file: petition_to_seal_eviction_next_steps.docx
  variable name: petition_to_seal_eviction_Post_interview_instructions[i]
  skip undefined: True
  tagged pdf: True
---
attachment:
  name: petition to seal eviction
  filename: petition_to_seal_eviction
  variable name: petition_to_seal_eviction_attachment[i]
  skip undefined: True
  docx template file: petition_to_seal_eviction.docx
  tagged pdf: True